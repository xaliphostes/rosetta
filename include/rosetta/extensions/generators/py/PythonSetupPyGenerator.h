#pragma once
#include "../common/CodeWriter.h"

// ============================================================================
// Python setup.py Generator - Modernized
// ============================================================================
class PythonSetupPyGenerator : public CodeWriter {
public:
    using CodeWriter::CodeWriter;

    void generate() override {
        emit(R"(
#!/usr/bin/env python3
"""
Setup script for ${MODULE}
Generated by binding_generator
"""

import os
import sys
from setuptools import setup, Extension
from setuptools.command.build_ext import build_ext

class get_pybind_include:
    def __str__(self):
        import pybind11
        return pybind11.get_include()

ext_modules = [
    Extension(
        '${MODULE}',
        sources=['generated_pybind11.cxx'],
        include_dirs=[
            get_pybind_include(),
            '.',
            '..',
)", {{"MODULE", config_.module_name}});

        // Dynamic include directories - indented to match context
        for (const auto &inc : config_.include_dirs) {
            if (inc.find("${") != std::string::npos) continue;  // Skip CMake variables
            line("            '" + inc + "',");
        }

        emit(R"(
        ],
        language='c++',
        extra_compile_args=['-std=c++20', '-fvisibility=hidden'],
    ),
]

setup(
    name='${MODULE}',
    version='${VERSION}',
    author='${AUTHOR}',
    description='${DESCRIPTION}',
    ext_modules=ext_modules,
    install_requires=['pybind11>=2.10', 'numpy'],
    python_requires='>=3.8',
    cmdclass={'build_ext': build_ext},
)
)", {
            {"MODULE", config_.module_name},
            {"VERSION", config_.version},
            {"AUTHOR", config_.author},
            {"DESCRIPTION", config_.description}
        });
    }
};