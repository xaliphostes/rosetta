# ============================================================================
# CMakeLists.txt for geometry
# ============================================================================
# Generated by rosetta-create
#
# Usage:
#   mkdir build && cd build
#   cmake ..
#   make
#   ./geometry_generator project.json
# ============================================================================

cmake_minimum_required(VERSION 3.16)
project(geometry_binding_generator VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# ============================================================================
# FetchContent for dependencies
# ============================================================================
include(FetchContent)

# ----------------------------------------------------------------------------
# Rosetta Library
# ----------------------------------------------------------------------------
message(STATUS "Fetching Rosetta library...")
FetchContent_Declare(
    rosetta
    GIT_REPOSITORY https://github.com/xaliphostes/rosetta.git
    GIT_TAG        main
    GIT_SHALLOW    TRUE
)

# Disable Rosetta unit tests
set(BUILD_TESTING OFF CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(rosetta)
FetchContent_GetProperties(rosetta SOURCE_DIR ROSETTA_SOURCE_DIR)
set(ROSETTA_INCLUDE_DIR "${ROSETTA_SOURCE_DIR}/include")

# ----------------------------------------------------------------------------
# geom Library (local path)
# ----------------------------------------------------------------------------
set(GEOM_SOURCE_DIR ".")
set(GEOM_INCLUDE_DIR "${GEOM_SOURCE_DIR}/include")
set(GEOM_SRC_DIR "${GEOM_SOURCE_DIR}/src")

if(NOT EXISTS ${GEOM_SOURCE_DIR})
    message(FATAL_ERROR "geom not found at: ${GEOM_SOURCE_DIR}")
endif()

# ----------------------------------------------------------------------------
# nlohmann_json (for configuration parsing)
# ----------------------------------------------------------------------------
find_package(nlohmann_json 3.9 QUIET)
if(NOT nlohmann_json_FOUND)
    message(STATUS "Fetching nlohmann_json...")
    FetchContent_Declare(
        nlohmann_json
        GIT_REPOSITORY https://github.com/nlohmann/json.git
        GIT_TAG        v3.11.3
        GIT_SHALLOW    TRUE
    )
    FetchContent_MakeAvailable(nlohmann_json)
endif()

# ============================================================================
# Generator executable
# ============================================================================
add_executable(geometry_generator
    main.cxx
)

# Place the executable in a convenient location
set_target_properties(geometry_generator PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/.."
)

# Include directories
target_include_directories(geometry_generator PRIVATE
    # Rosetta
    ${ROSETTA_INCLUDE_DIR}

    # geom library headers
    ${GEOM_INCLUDE_DIR}
    ${GEOM_SRC_DIR}

    # Local bindings directory
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/bindings
)

# Link libraries
target_link_libraries(geometry_generator PRIVATE
    nlohmann_json::nlohmann_json
)

# ============================================================================
# Print configuration summary
# ============================================================================
message(STATUS "")
message(STATUS "============================================================")
message(STATUS "geometry Binding Generator Configuration")
message(STATUS "============================================================")
message(STATUS "  geom source:      ${GEOM_SOURCE_DIR}")
message(STATUS "  Rosetta include:      ${ROSETTA_INCLUDE_DIR}")
message(STATUS "============================================================")
message(STATUS "")
message(STATUS "  1. Build: cmake --build .")
message(STATUS "  2. Run: ./geometry_generator project.json")
